<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Herramienta de Metas Ambientales</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-image: url('https://www.teorema.com.mx/wp-content/uploads/derechos-humanosam.jpg');  
            background-size: cover;
            background-position: center;
        }

        main {
            background-color: rgba(255, 255, 255, 0.8); 
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            width: 70%;
            max-width: 800px;
        }

        header {
            background-color: #4CAF50;
            color: white;
            padding: 20px;
            text-align: center;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
        }

        h1, h2 {
            text-align: center; 
        }

        section {
            margin-bottom: 20px;
        }

        .container {
            display: flex;
            margin-bottom: 10px;
        }

        .container label {
            margin-right: 10px;
        }

        select, input[type="number"], input[type="text"] {
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        button {
            padding: 10px 20px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #45a049;
        }

        #lista-objetos-reciclados {
            margin-top: 10px;
        }

        #lista-objetos-reciclados strong {
            display: block;
            margin-bottom: 5px;
        }

        #ticket-info {
            margin-top: 10px;
            font-weight: bold;
            color: red;
        }

        ul {
            padding-left: 20px;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <header>
        <h1>Herramienta de Metas Ambientales</h1>
    </header>
    <main>
        <section id="admin-settings">
            <h2>Configuración de Metas Mensuales</h2>
            <p>Establecer metas para el mes:</p>
            <div class="container">
                <label for="meta-botellas">Botellas plasticas:</label>
                <input type="number" id="meta-botellas" min="0" value="0">
            </div>
            <div class="container">
                <label for="meta-papel">Papel  (en kilos) :</label>
                <input type="number" id="meta-papel" min="0" value="0">
            </div>
            <div class="container">
                <label for="meta-cajas">Cajas de Cartón:</label>
                <input type="number" id="meta-cajas" min="0" value="0">
            </div>
            <button id="establecer-metas-btn" onclick="establecerMetas()">Establecer Metas</button>
        </section>
        <section id="goal-setting">
            <h2>Establecer Meta Ambiental</h2>
            <p>¡Hola! Por favor, ingresa tu información:</p>
            <div class="container">
                <label for="nombre">Nombre:</label>
                <input type="text" id="nombre" placeholder="Tu Nombre">
            </div>
            <div class="container">
                <label for="tipo-documento">Tipo de Documento:</label>
                <select id="tipo-documento">
                    <option value="Cedula de Ciudadanía">Cédula de Ciudadanía</option>
                    <option value="Tarjeta de Identidad">Tarjeta de Identidad</option>
                    <option value="DNI">DNI</option>
                    <option value="Pasaporte">Pasaporte</option>
                    <option value="Otro">Otro</option>
                </select>
            </div>
            <div class="container">
                <label for="documento">Número de Documento:</label>
                <input type="text" id="documento" placeholder="Número de Documento">
            </div>
            <p>¡Tu nueva meta es reciclar las siguientes cantidades este mes!</p>
            <ul id="metas-del-mes"></ul>
        </section>
        <section id="recycling">
            <h2>Registro de Objetos Reciclados</h2>
            <div class="container">
                <label for="botellas">Botellas plasticas:</label>
                <select id="botellas">
                    <option value="0">0</option>
                    <option value="5">5</option>
                    <option value="10">10</option>
                    <option value="15">15</option>
                    <option value="20">20</option>
                </select>
            </div>
            <div class="container">
                <label for="papel">Papel (en kilos) :</label>
                <select id="papel">
                    <option value="0">0</option>
                    <option value="2.5">2.5</option>
                    <option value="5">5</option>
                    <option value="7.5">7.5</option>
                    <option value="10">10</option>
                </select>
            </div>
            <div class="container">
                <label for="cajas">Cajas de Cartón:</label>
                <select id="cajas">
                    <option value="0">0</option>
                    <option value="3">3</option>
                    <option value="6">6</option>
                    <option value="9">9</option>
                    <option value="12">12</option>
                </select>
            </div>
            <button onclick="registrarObjetos()">Registrar</button>
            <div id="lista-objetos-reciclados"></div>
        </section>
        <section id="discount-ticket">
            <h2>Ticket de Descuento</h2>
            <p><span id="nombreUsuario"></span>, tu ticket de descuento:</p>
            <div id="ticket-info"></div>
            <button onclick="retirarDescuento()">Retirar Descuento</button>
        </section>
        <section id="discount-info">
            <h2>Descuentos Disponibles</h2>
            <ul id="descuentos-info"></ul>
        </section>
        <section id="report">
            <h2>Informe de Reciclaje</h2>
            <button id="btn-generar-informe">Mostrar Informe</button>
            <div id="informe-personas"></div>
        </section>
    </main>
    <script>
        const usuarios = JSON.parse(localStorage.getItem("usuarios")) || {};

        function inicializarSeguimiento(key) {
            usuarios[key].seguimiento = {
                botellas: 0,
                papel: 0,
                cajas: 0
            };
        }

        function obtenerSeguimiento(key) {
            return usuarios[key].seguimiento;
        }

        function actualizarSeguimiento(key, seguimiento) {
            usuarios[key].seguimiento = seguimiento;
        }

        function mostrarListaReciclados(key) {
            const seguimiento = obtenerSeguimiento(key);
            if (seguimiento) {
                const listaReciclados = document.getElementById("lista-objetos-reciclados");
                listaReciclados.innerHTML = `<strong>${usuarios[key].nombre} - Objetos Reciclados:</strong><br>`;
                for (const tipoObjeto in seguimiento) {
                    listaReciclados.innerHTML += `${tipoObjeto}: ${seguimiento[tipoObjeto]}<br>`;
                }
            }
        }

        function puedenModificarMetas() {
            const ahora = new Date();
            const mesActual = ahora.getMonth();
            const anioActual = ahora.getFullYear();
            const primerDiaProximoMes = new Date(anioActual, mesActual + 1, 1);
            const fechaLimite = new Date(primerDiaProximoMes);
            fechaLimite.setDate(fechaLimite.getDate() - 5);
            return ahora < fechaLimite;
        }

        function establecerMetas() {
            const metaBotellas = parseInt(document.getElementById("meta-botellas").value);
            const metaPapel = parseFloat(document.getElementById("meta-papel").value);
            const metaCajas = parseInt(document.getElementById("meta-cajas").value);

            const metasMensuales = {
                botellas: metaBotellas,
                papel: metaPapel,
                cajas: metaCajas
            };

            localStorage.setItem("metasMensuales", JSON.stringify(metasMensuales));
            mostrarMetasMensuales();
            document.getElementById("admin-settings").classList.add("hidden");
        }

        function mostrarMetasMensuales() {
            const metasMensuales = JSON.parse(localStorage.getItem("metasMensuales"));
            const metasDelMes = document.getElementById("metas-del-mes");
            metasDelMes.innerHTML = `
                <li>Botellas: ${metasMensuales.botellas}</li>
                <li>Papel: ${metasMensuales.papel} kg</li>
                <li>Cajas de Cartón: ${metasMensuales.cajas}</li>
            `;
        }

        function generarTicketDescuento(nombreUsuario) {
            const seguimiento = obtenerSeguimiento(nombreUsuario);
            const metasMensuales = JSON.parse(localStorage.getItem("metasMensuales"));
            const ticketInfo = document.getElementById("ticket-info");

            if (seguimiento.botellas >= metasMensuales.botellas && seguimiento.papel >= metasMensuales.papel && seguimiento.cajas >= metasMensuales.cajas) {
                ticketInfo.innerHTML = "¡Felicidades! Has alcanzado tus metas de reciclaje y has ganado un 20% de descuento.";
            } else {
                ticketInfo.innerHTML = "Aún no has alcanzado tus metas de reciclaje para este mes.";
            }
        }

        function mostrarDescuentosDisponibles() {
            const descuentosInfo = document.getElementById("descuentos-info");
            descuentosInfo.innerHTML = `
                <li>20% de descuento en la tienda al alcanzar las metas de reciclaje.</li>
            `;
        }

        function registrarObjetos() {
            const nombreUsuario = document.getElementById("nombre").value;
            const tipoDocumento = document.getElementById("tipo-documento").value;
            const documento = document.getElementById("documento").value;
            const botellas = parseInt(document.getElementById("botellas").value);
            const papel = parseFloat(document.getElementById("papel").value);
            const cajas = parseInt(document.getElementById("cajas").value);

            if (!nombreUsuario || !tipoDocumento || !documento) {
                
                Swal.fire({
                 icon: "info",
                 text: "Por favor, ingresa todos tus datos."
                 
               });
                return;
            }

            const nombreCompletoUsuario = `${nombreUsuario}_${tipoDocumento}_${documento}`;
            if (!usuarios[nombreCompletoUsuario]) {
                usuarios[nombreCompletoUsuario] = {
                    nombre: nombreUsuario,
                    tipoDocumento: tipoDocumento,
                    documento: documento,
                    seguimiento: {
                        botellas: 0,
                        papel: 0,
                        cajas: 0
                    }
                };
            }

            usuarios[nombreCompletoUsuario].seguimiento.botellas += botellas;
            usuarios[nombreCompletoUsuario].seguimiento.papel += papel;
            usuarios[nombreCompletoUsuario].seguimiento.cajas += cajas;

            localStorage.setItem("usuarios", JSON.stringify(usuarios));

            mostrarListaReciclados(nombreCompletoUsuario);
            generarTicketDescuento(nombreCompletoUsuario);
        }

        function retirarDescuento() {
            const nombreUsuario = document.getElementById("nombre").value;
            const tipoDocumento = document.getElementById("tipo-documento").value;
            const documento = document.getElementById("documento").value;
            const nombreCompletoUsuario = `${nombreUsuario}_${tipoDocumento}_${documento}`;
            const seguimiento = obtenerSeguimiento(nombreCompletoUsuario);
            const metasMensuales = JSON.parse(localStorage.getItem("metasMensuales"));
            const ticketInfo = document.getElementById("ticket-info");

            if (seguimiento.botellas >= metasMensuales.botellas && seguimiento.papel >= metasMensuales.papel && seguimiento.cajas >= metasMensuales.cajas) {
                Swal.fire({
                        position: "top",
                        icon: "success",
                        title: "Descuento retirado con éxito. Los objetos reciclados han sido actualizados.",
                        showConfirmButton: false,
                        timer: 5000
                         });
                ticketInfo.innerHTML = "";
                seguimiento.botellas -= metasMensuales.botellas;
                seguimiento.papel -= metasMensuales.papel;
                seguimiento.cajas -= metasMensuales.cajas;
                actualizarSeguimiento(nombreCompletoUsuario, seguimiento);
                mostrarListaReciclados(nombreCompletoUsuario);
            } else {
                
                Swal.fire({
                        icon: "error",
                        title: "Oops...",
                        text: "No has alcanzado tus metas para retirar el descuento.",
  
                     });
            }
        }

        function generarInformePersonas() {
            const informe = document.getElementById("informe-personas");
            informe.innerHTML = "<h3>Informe de Personas Registradas:</h3>";

            const usuariosOrdenados = Object.values(usuarios).sort((a, b) => {
                const totalA = a.seguimiento.botellas + a.seguimiento.papel + a.seguimiento.cajas;
                const totalB = b.seguimiento.botellas + b.seguimiento.papel + b.seguimiento.cajas;
                return totalB - totalA;
            });

            usuariosOrdenados.forEach((usuario, index) => {
                informe.innerHTML += `
                    <strong>${index + 1}. Nombre:</strong> ${usuario.nombre}<br>
                    <strong>Tipo de Documento:</strong> ${usuario.tipoDocumento}<br>
                    <strong>Número de Documento:</strong> ${usuario.documento}<br>
                    <strong>Seguimiento de Reciclaje:</strong><br>
                    Botellas: ${usuario.seguimiento.botellas}<br>
                    Papel: ${usuario.seguimiento.papel}<br>
                    Cajas de Cartón: ${usuario.seguimiento.cajas}<br><br>
                `;
            });
        }

        document.getElementById("btn-generar-informe").addEventListener("click", generarInformePersonas);

        document.addEventListener("DOMContentLoaded", () => {
            mostrarMetasMensuales();
            mostrarDescuentosDisponibles();
            generarInformePersonas();

            if (localStorage.getItem("metasMensuales") && !puedenModificarMetas()) {
                document.getElementById("admin-settings").classList.add("hidden");
            }
        });
    </script>
        <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
</body>
</html>
